<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WalletConnect Picker â€” Light</title>
  <style>
    :root {
      --bg: #f6f9fc;
      --card: #ffffff;
      --accent: #2563eb;
      --danger: #ef4444;
      --text: #0f172a;
      --muted: #64748b;
      --shadow: 0 6px 18px rgba(16,24,40,0.06);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg);
      color: var(--text);
    }
    .card {
      width: 480px;
      max-width: 94%;
      background: var(--card);
      padding: 22px;
      border-radius: 12px;
      box-shadow: var(--shadow);
    }
    h1 { margin: 0 0 8px 0; font-size: 18px; }
    .row { display:flex; gap:10px; margin-top:12px; }
    button {
      padding: 10px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }
    #connect { background: var(--accent); color: #fff; }
    #disconnect { background: var(--danger); color: #fff; }
    #status { margin-top: 14px; color: var(--muted); font-size: 13px; word-break:break-all; }
    .small { margin-top:8px; color:var(--muted); font-size:13px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Connect Wallet (WalletConnect v2 picker)</h1>
    <div class="row">
      <button id="connect">Connect Wallet</button>
      <button id="disconnect" disabled>Disconnect</button>
    </div>
    <div id="status">Not connected</div>
    <div class="small">Project ID: <strong id="projid"></strong></div>
  </div>

  <script>
    const PROJECT_ID = '38ca358a76d6819a0f6f5223030dee32';
    document.getElementById('projid').textContent = PROJECT_ID;

    const connectBtn = document.getElementById('connect');
    const disconnectBtn = document.getElementById('disconnect');
    const statusEl = document.getElementById('status');

    function loadScript(src) {
      return new Promise((res, rej) => {
        const s = document.createElement('script');
        s.src = src;
        s.async = true;
        s.onload = () => res(src);
        s.onerror = (e) => rej(new Error('Failed to load ' + src));
        document.head.appendChild(s);
      });
    }

    async function ensureUMDs() {
      const tries = [
        'https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.21.4/dist/index.umd.js',
        'https://unpkg.com/@walletconnect/ethereum-provider@2.21.4/dist/index.umd.js',
        'https://cdn.jsdelivr.net/npm/@walletconnect/modal@2.7.0/dist/index.umd.js',
        'https://unpkg.com/@walletconnect/modal@2.7.0/dist/index.umd.js'
      ];
      for (const url of tries.slice(0,2)) {
        try { await loadScript(url); window.WalletConnectEthereumProvider = window['@walletconnect/ethereum-provider']; break; } catch {}
      }
      for (const url of tries.slice(2,4)) {
        try { await loadScript(url); window.WalletConnectModal = window['@walletconnect/modal']; break; } catch {}
      }
    }

    let provider = null;
    let connectedAccount = null;

    async function initProvider() {
      provider = await window.WalletConnectEthereumProvider.EthereumProvider.init({
        projectId: PROJECT_ID,
        chains: [1],
        showQrModal: true,
        metadata: {
          name: 'Vercel WalletConnect Light Demo',
          description: 'Wallet picker demo',
          url: window.location.origin,
          icons: ['https://walletconnect.com/walletconnect-logo.svg']
        }
      });
      window.__WC_PROVIDER = provider;
    }

    async function connect() {
      connectBtn.disabled = true;
      statusEl.textContent = 'Loading libraries...';
      await ensureUMDs();
      if (!provider) await initProvider();

      try {
        statusEl.textContent = 'Opening wallet picker...';
        await provider.connect();
        const accounts = await provider.request({ method: 'eth_requestAccounts' });
        connectedAccount = accounts && accounts[0] ? accounts[0] : null;
        statusEl.textContent = connectedAccount ? `Connected: ${connectedAccount}` : 'Connected (no account returned)';
        disconnectBtn.disabled = false;

        if (provider.on) {
          provider.on('accountsChanged', accs => {
            connectedAccount = accs && accs[0] ? accs[0] : null;
            statusEl.textContent = connectedAccount ? `Connected: ${connectedAccount}` : 'Disconnected';
          });
          provider.on('chainChanged', chainId => {});
          provider.on('disconnect', () => cleanup());
        }
      } catch {
        statusEl.textContent = 'Connection failed';
        connectBtn.disabled = false;
      }
    }

    async function disconnect() {
      try { if (provider && provider.disconnect) await provider.disconnect(); } catch {}
      cleanup();
    }

    function cleanup() {
      connectedAccount = null;
      statusEl.textContent = 'Not connected';
      disconnectBtn.disabled = true;
      connectBtn.disabled = false;
      try { if (provider && provider.removeAllListeners) provider.removeAllListeners(); } catch {}
      provider = null;
      window.__WC_PROVIDER = null;
    }

    connectBtn.addEventListener('click', connect);
    disconnectBtn.addEventListener('click', disconnect);
  </script>
</body>
</html>
